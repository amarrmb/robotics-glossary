# MoveIt 2 Research Notes

**Topic**: MoveIt 2 - Motion Planning Framework for Robot Arms
**Target file**: `src/content/docs/software/ros2/moveit2.mdx`
**Research date**: 2026-01-21

---

## Key Concepts to Cover

### 1. What is MoveIt 2?
- Open-source motion planning framework for ROS 2
- Provides manipulation, motion planning, 3D perception, kinematics, control, and collision detection
- Third most popular package in the ROS ecosystem
- Developed and maintained by PickNik Robotics
- Commercial-friendly for developing applications, prototyping designs, and benchmarking algorithms

### 2. Core Architecture Components

#### move_group Node
- Central coordinator for MoveIt 2
- Provides ROS 2 actions and services for motion planning
- Loads planners, kinematics solvers, and collision checkers as plugins

#### Planning Pipeline
```
User Request → move_group → Planning Plugin → Trajectory → Controller
                   ↓
            Planning Scene (collision world)
```

#### Key Servers/Capabilities
- `move_group/MoveGroupMoveAction` - motion planning via ROS action
- `/execute_trajectory` action (moveit_msgs/action/ExecuteTrajectory) - trajectory execution
- Interacts with ros2_control for low-level controller interface

### 3. Motion Planning Algorithms (via OMPL)

**OMPL (Open Motion Planning Library)** - default planner backend

Supported planners include:
- **RRT** (Rapidly-exploring Random Tree) - fast single-query
- **RRT*** - asymptotically optimal version
- **PRM** (Probabilistic Roadmap) - multi-query environments
- **EST** (Expansive-Spaces Trees)
- **SBL** (Single-query Bi-directional)
- **KPIECE** - Kinodynamic Planning by Interior-Exterior Cell Exploration
- **SyCLOP** - Synergistic Combination of Layers of Planning

**Other supported libraries**:
- Pilz Industrial Motion Planner - simple linear/circular motions
- STOMP - Stochastic Trajectory Optimization for Motion Planning
- CHOMP - Covariant Hamiltonian Optimization for Motion Planning

### 4. Inverse Kinematics Solvers

| Solver | Description | Characteristics |
|--------|-------------|-----------------|
| **KDL** | Orocos Kinematics and Dynamics Library | Default, Newton-based, struggles with joint limits |
| **TRAC-IK** | TRACLabs IK solver | Concurrent KDL + SQP, more reliable near joint limits |
| **BioIK** | Particle optimization & genetic algorithms | Handles non-convex problems, multiple goals |
| **pick_ik** | Modern reimplementation of BioIK | Gradient descent + evolutionary algorithms |

### 5. Collision Detection
- Built-in collision checking during planning
- FCL (Flexible Collision Library) for geometric collision detection
- Self-Collision Matrix - pre-computed pairs that can safely skip checking
- Supports dynamic environment updates in real-time
- `longest_valid_segment_fraction` - controls discretization for collision checking

### 6. MoveIt Servo (Real-time Control)
- Stream End-Effector velocity commands for real-time control
- Enables teleoperation via joysticks, VR controllers, 6-DOF mice
- Singularity handling and collision avoidance
- Best with real-time kernel (Ubuntu RT or linux-image-rt-amd64)
- Input types:
  - `control_msgs::msg::JointJog` - joint velocities
  - `geometry_msgs::msg::TwistStamped` - Cartesian velocities
  - `geometry_msgs::msg::PoseStamped` - pose targets

### 7. MoveIt Task Constructor (MTC)
- Framework for composing complex manipulation tasks from stages
- Stage types:
  - **Generator** - creates solutions independently (e.g., CurrentState, GenerateGraspPose)
  - **Propagator** - passes solutions forward/backward
  - **Connector** - connects two states with a trajectory
- Used for pick-and-place sequences, assembly tasks
- Parallel execution of stages during planning

### 8. Configuration Requirements

#### URDF (Unified Robot Description Format)
- Robot geometry, links, joints, collision meshes
- Required for any MoveIt 2 setup

#### SRDF (Semantic Robot Description Format)
- Planning groups (arm, gripper, etc.)
- Virtual and passive joints
- Predefined robot poses
- Self-collision pairs to disable
- Generated by MoveIt Setup Assistant

#### Key Config Files
- `kinematics.yaml` - IK solver configuration
- `ompl_planning.yaml` - OMPL planner parameters
- `joint_limits.yaml` - velocity/acceleration limits
- `moveit_controllers.yaml` - ros2_control integration

### 9. MoveIt Setup Assistant
- GUI tool for configuring robots
- Generates SRDF and all configuration files
- Self-Collision Matrix generation
- Planning group definition
- ros2_control interface setup

---

## Current Version Information

### ROS 2 Distribution Support
| Distribution | MoveIt Version | Ubuntu | Status |
|--------------|----------------|--------|--------|
| **Jazzy** | 2.10.x | 24.04 (Noble) | **Recommended LTS** |
| Humble | 2.5.x | 22.04 (Jammy) | LTS (being phased out) |
| Rolling | Latest | 24.04 | Development |

### Installation
```bash
# Jazzy (recommended)
sudo apt install ros-jazzy-moveit

# Humble
sudo apt install ros-humble-moveit
```

### Recommended Middleware
- CycloneDDS recommended by MoveIt team

---

## NVIDIA + ROS 2 Ecosystem Integration

### Isaac ROS cuMotion
- GPU-accelerated motion planning as MoveIt 2 plugin
- Backend: cuRobo (CUDA accelerated robotics library)
- Package: `isaac_ros_cumotion_moveit`

**Key Advantages**:
- 1000s of trajectories planned in parallel on GPU
- Smooth, optimal-time trajectories
- Better performance in cluttered environments
- Sub-second planning times

**Components**:
- `isaac_ros_cumotion` - planner node + robot segmentation node
- `isaac_ros_cumotion_examples` - usage examples
- `isaac_ros_cumotion_moveit` - MoveIt 2 plugin

### Isaac Sim Integration
- `isaac_moveit` ROS 2 packages included with Isaac Sim
- Located in `humble_ws` or `jazzy_ws` directories
- Uses `topic_based_ros2_control` hardware interface
- Supports Franka, UR, and other robot arms

### nvblox Integration
- 3D reconstruction from depth streams
- Signed Distance Field (SDF) for efficient planning
- Robot segmentation from depth images

### Configuration for cuMotion
Requires:
- URDF file
- XRDF file (cuMotion-specific robot description)

---

## Code Examples to Include

### 1. Basic Motion Planning (Python)
```python
import rclpy
from rclpy.node import Node
from moveit.planning import MoveItPy
from geometry_msgs.msg import PoseStamped

def main():
    rclpy.init()

    # Initialize MoveItPy
    moveit = MoveItPy(node_name="moveit_py")
    arm = moveit.get_planning_component("arm")

    # Set target pose
    target_pose = PoseStamped()
    target_pose.header.frame_id = "base_link"
    target_pose.pose.position.x = 0.5
    target_pose.pose.position.y = 0.0
    target_pose.pose.position.z = 0.4
    target_pose.pose.orientation.w = 1.0

    arm.set_goal_state(pose_stamped=target_pose, end_effector_link="gripper_link")

    # Plan and execute
    plan_result = arm.plan()
    if plan_result:
        arm.execute()

if __name__ == "__main__":
    main()
```

### 2. Named Pose Target
```python
# Move to predefined pose from SRDF
arm.set_goal_state(configuration_name="home")
arm.plan()
arm.execute()
```

### 3. Joint Space Goal
```python
# Set specific joint values
joint_values = {
    "joint_1": 0.0,
    "joint_2": -0.785,
    "joint_3": 0.0,
    "joint_4": -2.356,
    "joint_5": 0.0,
    "joint_6": 1.571,
    "joint_7": 0.785,
}
arm.set_goal_state(joint_values=joint_values)
```

### 4. MoveIt Servo (Teleoperation)
```python
from geometry_msgs.msg import TwistStamped

# Publish Cartesian velocity commands
twist = TwistStamped()
twist.header.frame_id = "base_link"
twist.twist.linear.x = 0.1  # 10 cm/s forward
twist.twist.angular.z = 0.0

servo_publisher.publish(twist)
```

---

## Diagrams Needed

### 1. Architecture Diagram
```
┌─────────────────────────────────────────────────────────────────┐
│                        User Application                          │
│                (Python API / C++ API / RViz)                    │
└────────────────────────────┬────────────────────────────────────┘
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                        move_group Node                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Planning   │  │  Kinematics  │  │  Collision   │          │
│  │   Plugin     │  │   Plugin     │  │   Checker    │          │
│  │  (OMPL/etc)  │  │ (KDL/TRAC)   │  │    (FCL)     │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                             │                                    │
│  ┌──────────────────────────▼──────────────────────────────┐   │
│  │              Planning Scene Monitor                       │   │
│  │         (Robot State + World Geometry)                    │   │
│  └───────────────────────────────────────────────────────────┘   │
└────────────────────────────┬────────────────────────────────────┘
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                      ros2_control                                │
│              (Joint Trajectory Controller)                       │
└────────────────────────────┬────────────────────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   Robot / Sim   │
                    └─────────────────┘
```

### 2. Planning Pipeline Flow
```
Goal Pose → IK Solver → Joint Goal → Motion Planner → Trajectory → Controller
                ↓                           ↓
        Planning Scene ──────────── Collision Checking
```

### 3. MoveIt Task Constructor Stages (for pick-and-place)
```
┌─────────────────┐
│  Current State  │ (Generator)
└────────┬────────┘
         ▼
┌─────────────────┐
│ Move to Pre-grasp│ (Connector)
└────────┬────────┘
         ▼
┌─────────────────┐
│  Approach Grasp │ (Propagator)
└────────┬────────┘
         ▼
┌─────────────────┐
│  Close Gripper  │ (Propagator)
└────────┬────────┘
         ▼
┌─────────────────┐
│ Lift Object     │ (Propagator)
└────────┬────────┘
         ▼
┌─────────────────┐
│ Move to Place   │ (Connector)
└────────┬────────┘
         ▼
┌─────────────────┐
│  Open Gripper   │ (Propagator)
└────────┬────────┘
         ▼
┌─────────────────┐
│    Retreat      │ (Propagator)
└─────────────────┘
```

---

## Prerequisites / Related Concepts

1. **TF2** - Transform library (required for frame management)
2. **Kinematics** - Forward/Inverse kinematics concepts
3. **Motion Planning** - General motion planning theory
4. **ros2_control** - Robot controller interface
5. **URDF/SRDF** - Robot description formats
6. **ROS 2** - Middleware framework

---

## Source URLs for Citations

### Official Documentation
- [MoveIt 2 Official Website](https://moveit.ai/)
- [MoveIt 2 Documentation (Humble)](https://moveit.picknik.ai/humble/doc/tutorials/getting_started/getting_started.html)
- [MoveIt 2 Documentation (Rolling/Jazzy)](https://moveit.picknik.ai/main/doc/tutorials/getting_started/getting_started.html)
- [MoveIt 2 GitHub Repository](https://github.com/moveit/moveit2)
- [MoveIt 2 Tutorials Repository](https://github.com/moveit/moveit2_tutorials)

### NVIDIA Integration
- [Isaac ROS cuMotion](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_cumotion/index.html)
- [Isaac ROS cuMotion MoveIt Plugin](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_cumotion/isaac_ros_cumotion_moveit/index.html)
- [cuMotion MoveIt Tutorial with Isaac Sim](https://nvidia-isaac-ros.github.io/concepts/manipulation/cumotion_moveit/tutorial_isaac_sim.html)
- [Isaac Sim MoveIt 2 Tutorial](https://docs.isaacsim.omniverse.nvidia.com/5.0.0/ros2_tutorials/tutorial_ros2_moveit.html)
- [cuRobo Documentation](https://curobo.org/)

### Planning and IK
- [OMPL Library](https://ompl.kavrakilab.org/)
- [OMPL Planner Tutorial](https://moveit.picknik.ai/humble/doc/examples/ompl_interface/ompl_interface_tutorial.html)
- [TRAC-IK Tutorial](https://moveit.picknik.ai/humble/doc/examples/trac_ik/trac_ik_tutorial.html)
- [pick_ik Tutorial](https://moveit.picknik.ai/main/doc/how_to_guides/pick_ik/pick_ik_tutorial.html)
- [IK Benchmarking](https://github.com/PickNikRobotics/ik_benchmarking)

### MoveIt Servo
- [Realtime Servo Tutorial (Humble)](https://moveit.picknik.ai/humble/doc/examples/realtime_servo/realtime_servo_tutorial.html)
- [Gamepad Teleoperation Tutorial](https://moveit.picknik.ai/main/doc/how_to_guides/controller_teleoperation/controller_teleoperation.html)
- [MoveIt Servo Announcement](https://moveit.ai/moveit/ros2/servo/jog/2020/09/09/moveit2-servo.html)

### Task Constructor
- [MoveIt Task Constructor Concepts](https://moveit.picknik.ai/main/doc/concepts/moveit_task_constructor/moveit_task_constructor.html)
- [Pick and Place with MTC Tutorial](https://moveit.picknik.ai/humble/doc/tutorials/pick_and_place_with_moveit_task_constructor/pick_and_place_with_moveit_task_constructor.html)

### Configuration
- [MoveIt Setup Assistant](https://moveit.picknik.ai/main/doc/examples/setup_assistant/setup_assistant_tutorial.html)
- [URDF and SRDF Tutorial](https://moveit.picknik.ai/humble/doc/examples/urdf_srdf/urdf_srdf_tutorial.html)
- [MoveIt Configuration Guide](https://moveit.picknik.ai/main/doc/how_to_guides/moveit_configuration/moveit_configuration_tutorial.html)

### Version/Release Info
- [MoveIt 2 Jazzy Release](https://moveit.ai/release/jazzy/rolling/2024/06/30/New-MoveIt-LTS-release-for-ROS-2-Jazzy.html)
- [MoveIt Binary Install](https://moveit.ai/install-moveit2/binary/)
- [MoveIt Source Build](https://moveit.ai/install-moveit2/source/)

### Supported Robots
- [MoveIt Robots Page](https://moveit.ai/robots/)
- [Panda MoveIt Config](https://github.com/moveit/panda_moveit_config)

---

## Style Notes (from existing entries)

Based on review of nav2.mdx and tf2.mdx:

1. **Frontmatter**: title, description, last_validated, sidebar badge
2. **Imports**: Astro Starlight components (Aside, Card, CardGrid, LinkCard, Tabs, TabItem)
3. **Badge span**: `<span class="level-badge practical">Practical</span>`
4. **Opening**: Bold term definition, one-liner summary
5. **Aside notes**: For key callouts
6. **Prerequisites section**: CardGrid with LinkCards
7. **"Why X Matters"** section: Bullet points
8. **Architecture section**: ASCII diagrams, tables
9. **Code Examples**: Tabs for Python/C++, YAML configs
10. **CLI Commands**: bash code blocks
11. **Common Issues**: Tables with Problem/Cause/Solution
12. **Related Terms**: CardGrid with LinkCards
13. **Learn More**: External tutorial links
14. **Sources**: Citation links at bottom

---

## Notes for Content Creation

- Badge type: **Practical** (like nav2/tf2 - hands-on tool)
- Focus on practical usage with MoveIt 2 Jazzy (current LTS)
- Include NVIDIA cuMotion integration prominently
- Show both Python and C++ examples where applicable
- Link to related concepts: motion-planning.mdx, kinematics.mdx, tf2.mdx
- Emphasize ros2_control integration
- Common issues table for debugging
